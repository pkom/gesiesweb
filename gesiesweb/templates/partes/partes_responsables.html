{% extends 'base.html' %}

{% load staticfiles %}
{% load thumbnail %}

{% block breadcrumbs %}
  <!-- #section:basics/content.breadcrumbs -->
  <div class="breadcrumbs" id="breadcrumbs">
    <script type="text/javascript">
      try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
    </script>

    <ul class="breadcrumb">
      <li>
        <i class="ace-icon fa fa-bullhorn home-icon"></i>
        <a href="{% url 'parte:partes-responsable' %}">Partes del centro</a>
      </li>
      <li class="active">Partes del centro</li>
    </ul><!-- /.breadcrumb -->

    <!-- #section:basics/content.searchbox -->
    <div class="nav-search" id="nav-search">
      <form class="form-search">
        <span class="input-icon">
          <input type="text" placeholder="Buscar ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
          <i class="ace-icon fa fa-search nav-search-icon"></i>
        </span>
      </form>
    </div><!-- /.nav-search -->

    <!-- /section:basics/content.searchbox -->
  </div>
  <!-- /section:basics/content.breadcrumbs -->
{% endblock breadcrumbs %}



{% block pageheader %}
  <div class="page-header">
    <h1>
      Partes del Centro
      <small>
        <i class="ace-icon fa fa-angle-double-right"></i>
        Partes del Centro
      </small>
    </h1>
  </div><!-- /.page-header -->
{% endblock pageheader %}


{% block contenido %}
    <div class="table-header">
      <span class="badge badge-success">{{ total_partes }}</span>
      <span> Partes del centro</span>
      <span class="badge badge-important">Parte {{ total_partes_partes }}</span>
      <span class="badge badge-important">Comunicados {{ total_partes_comunicados }}</span>
      <span class="badge badge-important">Cerrados {{ total_partes_cerrados }}</span>
    </div>


    <div>
        <table id="partes-responsable" class="table table-striped table-bordered table-hover dataTable" aria-describedby="partes-responsable_info">
            <thead>
                <tr role="row">
                    <th class="hidden-480 sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Id: activate to sort column ascending">Id</th>
                    <th class="sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Fecha: activate to sort column ascending">Fecha</th>
                    <th class="sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Grupo: activate to sort column ascending">Grupo</th>
                    <th class="sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Grupo: activate to sort column ascending">FotoA</th>
                    <th class="sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Update: activate to sort column ascending">Alumno</th>
                    <th class="sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Grupo: activate to sort column ascending">FotoP</th>
                    <th class="sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Update: activate to sort column ascending">Profesor</th>
                    <th class="hidden-480 sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Status: activate to sort column ascending">Parte</th>
                    <th class="hidden-480 sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Status: activate to sort column ascending">Comun.</th>
                    <th class="hidden-480 sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Status: activate to sort column ascending">Cerrado</th>
                    <th class="sorting_disabled" role="columnheader" rowspan="1" colspan="1" aria-label=""></th>
                </tr>
            </thead>


            <tbody role="alert" aria-live="polite" aria-relevant="all">
            {% for parte in partes %}
                {% cycle 'odd' 'event' as rowcolors silent %}
                <tr class="{{ rowcolors }}">
                    <td class="hidden-480 align-right" style="vertical-align: middle">
                        <a href="{% url "parte:detalle" parte.id %}">{{ parte.id }}</a>
                    </td>
                    <td class="align-center" style="vertical-align: middle">
                        {{ parte.fecha | date:"SHORT_DATE_FORMAT" }}
                    </td>
                    <td class="align-center" style="vertical-align: middle">
                        {{ parte.get_nombre_grupo_alumno }}
                    </td>
                    <td class="align-left" style="vertical-align: middle">
                        {% if parte.grupoalumno.cursoalumno.alumno.foto %}
                            {% thumbnail parte.grupoalumno.cursoalumno.alumno.foto "50x40" as fotoalu %}
                                <img class="nav-user-photo" style="border-radius: 15px; margin:{{ fotoalu|margin:"50x40" }}"
                                    src="{{ fotoalu.url }}" width="{{ fotoalu.width }}" height="{{ fotoalu.height }}"
                                    alt="Foto de {{ parte.grupoalumno.cursoalumno.alumno }}" />
                            {% endthumbnail %}
                        {% endif %}
                    </td>
                    <td class="align-left" style="vertical-align: middle">
                        {{ parte.get_nombre_completo_alumno }}</td>
                    <td class="align-left" style="vertical-align: middle">
                        {% if parte.cursoprofesor.profesor.foto %}
                            {% thumbnail parte.cursoprofesor.profesor.foto "50x40" as fotoprofe %}
                                <img class="nav-user-photo" style="border-radius: 15px; margin:{{ fotoprofe|margin:"50x40" }}"
                                    src="{{ fotoprofe.url }}" width="{{ fotoprofe.width }}" height="{{ fotoprofe.height }}"
                                    alt="Foto de {{ parte.cursoprofesor.profesor }}" />
                            {% endthumbnail %}
                        {% endif %}
                    </td>
                    <td class="align-left" style="vertical-align: middle">
                        {{ parte.get_nombre_completo_profesor }}</td>
                    <td class="hidden-480 align-center" style="vertical-align: middle">
                        {% if parte.con_parte %}
                            <i class="ace-icon fa fa-check bigger-120"></i>
                        {% endif %}
                    </td>
                    <td class="hidden-480 align-center" style="vertical-align: middle">
                        {% if parte.comunicado %}
                            <i class="ace-icon fa fa-check bigger-120"></i>
                        {% endif %}
                    </td>
                    <td class="hidden-480 align-center" style="vertical-align: middle">
                        {% if parte.cerrado %}
                            <i class="ace-icon fa fa-check bigger-120"></i>
                        {% endif %}
                    </td>

                    <td class="align-center" style="vertical-align: middle">
                        <div class="hidden-sm hidden-xs action-buttons">
                            <a class="blue tooltip-info" href="{% url "parte:detalle" parte.id %}" data-rel="tooltip" title="" data-original-title="Ver">
                                <i class="ace-icon fa fa-search-plus bigger-130"></i>
                            </a>

                            <a class="green tooltip-success" href="{% url "parte:editar" parte.id %}" data-rel="tooltip" title="" data-original-title="Edita">
                                <i class="ace-icon fa fa-pencil bigger-130"></i>
                            </a>

                            <a class="red tooltip-error" href="{% url "parte:eliminar" parte.id %}" data-rel="tooltip" title="" data-original-title="Elimina">
                                <i class="ace-icon fa fa-trash-o bigger-130"></i>
                            </a>

                        </div>

                        <div class="hidden-md hidden-lg">
                            <div class="inline position-relative">
                                <button class="btn btn-minier btn-yellow dropdown-toggle" data-toggle="dropdown" data-position="auto">
                                    <i class="ace-icon fa fa-caret-down icon-only bigger-120"></i>
                                </button>

                                <ul class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close">
                                    <li>
                                        <a href="{% url "parte:detalle" parte.id %}" class="tooltip-info" data-rel="tooltip" title="" data-original-title="Ver">
                                            <span class="blue">
                                                <i class="ace-icon fa fa-search-plus bigger-120"></i>
                                            </span>
                                        </a>
                                    </li>

                                    <li>
                                        <a href="{% url "parte:editar" parte.id %}" class="tooltip-success" data-rel="tooltip" title="" data-original-title="Edita">
                                            <span class="green">
                                                <i class="ace-icon fa fa-pencil-square-o bigger-120"></i>
                                            </span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="{% url "parte:eliminar" parte.id %}" class="tooltip-error" data-rel="tooltip" title="Elimina">
                                            <span class="red">
                                                <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                            </span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
	</div>

<table id="tabla-pruebas" class="table table-striped table-bordered table-hover dataTable" aria-describedby="partes-responsable_info">
            <thead>
                <tr role="row">
                    <th class="hidden-480 sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Id: activate to sort column ascending">Id</th>
                    <th class="sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Fecha: activate to sort column ascending">Fecha</th>
                    <th class="sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Grupo: activate to sort column ascending">Grupo</th>
                    <th class="sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Grupo: activate to sort column ascending">FotoA</th>
                    <th class="sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Update: activate to sort column ascending">Alumno</th>
                    <th class="sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Grupo: activate to sort column ascending">FotoP</th>
                    <th class="sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Update: activate to sort column ascending">Profesor</th>
                    <th class="hidden-480 sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Status: activate to sort column ascending">Parte</th>
                    <th class="hidden-480 sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Status: activate to sort column ascending">Comun.</th>
                    <th class="hidden-480 sorting align-center" role="columnheader" tabindex="0" aria-controls="partes-responsable" rowspan="1" colspan="1" aria-label="Status: activate to sort column ascending">Cerrado</th>
                    <th class="sorting_disabled" role="columnheader" rowspan="1" colspan="1" aria-label=""></th>
                </tr>
            </thead>

</table>

{% endblock contenido %}

{% block extra_js_links %}
		<script src="{% static 'js/jquery.dataTables.min.js' %}"></script>
		<script src="{% static 'js/jquery.dataTables.bootstrap.min.js' %}"></script>
{% endblock extra_js_links %}

{% block extra_js %}
    <script type="text/javascript">
        jQuery(function($) {

            var oTablaPruebas =
            $('#tabla-pruebas').dataTable({
                "language": {
                    "url": "{% static 'js/dataTables.spanish.lang' %}"
                },
                "order": [[ 1, "desc" ], [ 0, "desc" ]],
                bAutoWidth: false,
                "aoColumns": [
                  null, null, null,
                  { "bSortable": false },
                  null,
                  { "bSortable": false },
                  null, null, null, null,
                  { "bSortable": false }
                ],
                "processing": true,
                "serverSide": true,
                "ajax": "{% url 'parte:partes_responsable_json' %}",
                "columnDefs": [
                    {
                        // The `data` parameter refers to the data for the cell (defined by the
                        // `data` option, which defaults to the column being worked with, in
                        // this case `data: 0`.
                        "render": function ( data, type, row ) {
                            return row[3] + data;
                        },
                        "targets": 4
                    },
                    {
                        // The `data` parameter refers to the data for the cell (defined by the
                        // `data` option, which defaults to the column being worked with, in
                        // this case `data: 0`.
                        "render": function ( data, type, row ) {
                            return row[5] + data;
                        },
                        "targets": 6
                    },
                    { "visible": false,  "targets": [ 3 ] },
                    { "visible": false,  "targets": [ 5 ] }
                ]
            });

            var oTable1 =
            $('#partes-responsable')
            .dataTable( {
                "language": {
                    "url": "{% static 'js/dataTables.spanish.lang' %}"
                },
                "order": [[ 1, "desc" ], [ 0, "desc" ]],
                bAutoWidth: false,
                "aoColumns": [
                  null, null, null,
                  { "bSortable": false },
                  null,
                  { "bSortable": false },
                  null, null, null, null,
                  { "bSortable": false }
                ],
                "columnDefs": [
                    {
                        // The `data` parameter refers to the data for the cell (defined by the
                        // `data` option, which defaults to the column being worked with, in
                        // this case `data: 0`.
                        "render": function ( data, type, row ) {
                            return row[3] + data;
                        },
                        "targets": 4
                    },
                    {
                        // The `data` parameter refers to the data for the cell (defined by the
                        // `data` option, which defaults to the column being worked with, in
                        // this case `data: 0`.
                        "render": function ( data, type, row ) {
                            return row[5] + data;
                        },
                        "targets": 6
                    },
                    { "visible": false,  "targets": [ 3 ] },
                    { "visible": false,  "targets": [ 5 ] }
                ]


                //,
                //"sScrollY": "200px",
                //"bPaginate": false,

                //"sScrollX": "100%",
                //"sScrollXInner": "120%",
                //"bScrollCollapse": true,
                //Note: if you are applying horizontal scrolling (sScrollX) on a ".table-bordered"
                //you may want to wrap the table inside a "div.dataTables_borderWrap" element

                //"iDisplayLength": 50
            } );



            $(document).on('click', 'th input:checkbox' , function(){
                var that = this;
                $(this).closest('table').find('tr > td:first-child input:checkbox')
                .each(function(){
                    this.checked = that.checked;
                    $(this).closest('tr').toggleClass('selected');
                });
            });


            $('[data-rel="tooltip"]').tooltip({placement: tooltip_placement});
            function tooltip_placement(context, source) {
                var $source = $(source);
                var $parent = $source.closest('table')
                var off1 = $parent.offset();
                var w1 = $parent.width();

                var off2 = $source.offset();
                //var w2 = $source.width();

                if( parseInt(off2.left) < parseInt(off1.left) + parseInt(w1 / 2) ) return 'right';
                return 'left';
            }

        })
    </script>
{% endblock extra_js %}